<!-- Create the static graph-->
{% extends 'website/base.html' %}
{%  load staticfiles %}

{% block title %}Graph{% endblock %}
{% block head %}
	<link type="text/css" rel="stylesheet" href="{% static 'website/dist/vis-network.min.css' %}"/>
        <script type="text/javascript" src="{% static 'website/dist/vis.js' %}"></script>
        <link href="{% static 'website/dist/vis.css' %}" rel="stylesheet" type="text/css"/>
        <link type="text/css" rel="stylesheet" href="{% static 'website/styles_grafo.css' %}"/>
   	<script type = "text/javascript" src = "https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
	<style type="text/css">
	table, th, td{
	    border: 1px solid black;
    	    border-collapse: collapse;
	}
	th, td {
    	 padding: 15px;
    	 text-align: center;
	}
	table#colors tr:nth-child(even) {
    	 background-color: #eee;	
	}
	table#colors tr:nth-child(odd) {
    	 background-color: #fff;
	}
	table#colors th {
    	 background-color: black;
    	 color: white;
	}
	.togger{
    	  display: none;
    	  position: absolute;
    	  top: 50px;
  	  left: 30px;
    	  background-color: #ffffff;
  	  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    	  text-align: center;
    	  border: 1px solid #45a049;
    	  font-size: 10px
    	  box-shadow: 0 1px 0 0 rgba(0,0,0,.12),0 5px 10px -3px rgba(0,0,0,.3);
	}
	#show{
          position: absolute;
          left:50px;
          top: 10px;
          -moz-border-radius: 17px;
          border-radius: 17px;
          position:absolute;
          display:inline-block;
          background-position: 2px 2px;
          background-repeat:no-repeat;
          cursor: pointer;
          -webkit-touch-callout: none;
          -webkit-user-select: none;
          -khtml-user-select: none;
          -moz-user-select: none;
          -ms-user-select: none;
          user-select: none;
          }
      #show:hover {
          box-shadow: 0 0 3px 3px rgba(56, 207, 21, 0.30);
      }
	</style> 
	<script type="text/javascript">
        var nodes = null;
        var edges = null;
        var network = null;

        function draw() {

            // create some nodes
{%  if nodos %}
var nodes = [{{ nodos|safe}}];
{% endif %}

{%  if edge %}
var edges = [{{ edge|safe}}];
{% endif %}

// randomly create some nodes and edges
      var container = document.getElementById('grafo');
            var data = {
                nodes: nodes,
                edges: edges
            };
            var options = {
                nodes: {
                    shape: 'dot',
                    size: 20
                },
                physics: {
                    forceAtlas2Based: {
                        gravitationalConstant: -10,
                        centralGravity: 0.005,
                        springLength: 230,
                        springConstant: 0.18
                    },
                    maxVelocity: 146,
                    solver: 'forceAtlas2Based',
                    timestep: 0.35,
                    stabilization: {iterations: 150}
                },edges: {arrows:{to:{enabled:true}}},
                // Color of the nodes
                groups:{
                    "P":{
                        color:{background:'red',border:'maroon'},
                        },
                    "E":{color:{background:'coral',border:'black'},
                        },
                    "R":{color:{background:'green',border:'darkGreen'},
                        },
                    "B":{color:{background:'gold',border:'brown'},
                        },
                    "C":{color:{background:'black',border:'red'},
                        }
	            },
	             interaction: {
                      navigationButtons: true,
                      keyboard: true
                } ,
            };
          network = new vis.Network(container, data, options);

          // add event listeners
          network.on("click", function (params) {
                // Check if you clicked on a node; if so, display the title (if any) in a popup
                network.interactionHandler._checkShowPopup(params.pointer.DOM);
            });
          network.on('select', function(params) {
                document.getElementById('selection').innerHTML = 'Selection: ' + params.nodes;
          });
          network.on("stabilizationProgress", function(params) {
                var maxWidth = 496;
                var minWidth = 20;
                var widthFactor = params.iterations/params.total;
                var width = Math.max(minWidth,maxWidth * widthFactor);

                document.getElementById('bar').style.width = width + 'px';
                document.getElementById('text').innerHTML = Math.round(widthFactor*100) + '%';
          });
          network.once("stabilizationIterationsDone", function() {
                document.getElementById('text').innerHTML = '100%';
                document.getElementById('bar').style.width = '496px';
                document.getElementById('loadingBar1').style.opacity = 0;
                // really clean the dom element
                setTimeout(function () {document.getElementById('loadingBar1').style.display = 'none';}, 500);
           });

    }
	$(document).ready(function() {
              $("#show").click(function(){
                 $(".togger").toggle("fast" );
              });
           });
  </script>

{% endblock %}
{% block body1 %}
<body onload="draw();">
{% endblock %}
{% block body %}

    <div id="wrapper">
        <div id="grafo" style="position: absolute; top: 15px; bottom: 10px; height:100%; width: 100%;"></div>
        <button id = "show" style="padding: 0px; border: 0px; "><img src="{% static 'website/dist/img/network/plus.png' %}" class = "vis-button"></button>
      <div class = "togger" >
        <table id="colors">
              <tr>
                  <th>Color</th>
                  <th>Node</th>
              </tr>
              <tr>
                  <td><img src="{% static 'website/images/black.ico' %}" alt="Black"  width="50%" height="50%"></td>
                  <td>Choosen Node</td>
              </tr>
              <tr>
                  <td><img src="{% static 'website/images/red.ico' %}" alt="Red"  width="50%" height="50%"></td>
                  <td>Provider Node</td>
              </tr>
              <tr>
                  <td><img src="{% static 'website/images/cream.ico' %}" alt="Cream"  width="50%" height="50%"></td>
                  <td>Provider Edge Node</td>
              </tr>
              <tr>
                  <td><img src="{% static 'website/images/yellow.ico' %}" alt="Yellow"  width="50%" height="50%"></td>
                  <td>Border Node</td>
              </tr>
              <tr>
                  <td><img src="{% static 'website/images/green.ico' %}" alt="Green"  width="50%" height="50%"></td>
                  <td>Backup Node</td>
              </tr>
            </table>
	
      </div>
	<div id="loadingBar1">
            <div class="outerBorder">
                <div id="text">0%</div>
                <div id="border">
                    <div id="bar"></div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
